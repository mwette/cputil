#!/bin/sh
#
# mindist: create minimum distribution for running cputil
#
# Copyright (C) 2016 Matthew R. Wette
# 
# Copying and distribution of this file, with or without modification,
# are permitted in any medium without royalty provided the copyright
# notice and this notice are preserved.  This file is offered as-is,
# without any warranty.

prefix=@prefix@
srcdist=..

if [ $# -ne 2 ]; then
  echo "usage: mindist <destdir> <pkgsubdir>"
  exit 1
fi
destdir=$1
pkgsubdir=$2

dst=$destdir/$prefix

rm -f $dst/bin/callgrind*
rm -f $dst/bin/cg_*
rm -f $dst/bin/ms_print
rm -f $dst/bin/valgrind-di-server
rm -f $dst/bin/valgrind-listener
rm -f $dst/bin/vgdb
if [ -f $dst/bin/valgrind ]; then
  mv $dst/bin/valgrind $destdir/$pkgsubdir/vg
fi
#
if [ -f $dst/include/valgrind/libvex_ir.h ]; then
  cp $dst/include/valgrind/libvex_ir.h $destdir/$pkgsubdir
fi
if [ -f $dst/include/valgrind/cputil.h ]; then
   mv $dst/include/valgrind/cputil.h $dst
fi
rm -rf $dst/include
mkdir -p $dst/include
if [ -f $dst/cputil.h ]; then
  mv $dst/cputil.h $dst/include/
fi
rm -rf $dst/share
rm -rf $dst/lib/pkgconfig
#
rm -rf $destdir/$pkgsubdir/vgpreload_memcheck*
rm -rf $destdir/$pkgsubdir/vgpreload_massif*
rm -rf $destdir/$pkgsubdir/vgpreload_exp*
rm -rf $destdir/$pkgsubdir/vgpreload_drd*
rm -rf $destdir/$pkgsubdir/vgpreload_helgrind*
#
rm -f $destdir/$pkgsubdir/s390*
rm -f $destdir/$pkgsubdir/power*
rm -f $destdir/$pkgsubdir/mips*
rm -f $destdir/$pkgsubdir/arm*
#
rm -rf destdirdst/$pkgsubdir/none*
rm -rf $destdir/$pkgsubdir/memcheck*
rm -rf $destdir/$pkgsubdir/massif*
rm -rf $destdir/$pkgsubdir/getoff*
rm -rf $destdir/$pkgsubdir/helgrind*
rm -rf $destdir/$pkgsubdir/lackey*
rm -rf $destdir/$pkgsubdir/exp*
rm -rf $destdir/$pkgsubdir/drd*
rm -rf $destdir/$pkgsubdir/cachegrind*
rm -rf $destdir/$pkgsubdir/callgrind*
#
rm -f $destdir/$pkgsubdir/*.xml
rm -f $destdir/$pkgsubdir/*.a
rm -f $destdir/$pkgsubdir/default.supp
#
#strip $destdir/$pkgsubdir/cputil-*

# --- last line of mindist ---
